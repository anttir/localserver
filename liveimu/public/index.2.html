<html>

<head>
	<title>Live IMU - 3D Example</title>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="main.1.js"></script>
	<link rel="stylesheet" type="text/css" href="main.css" />
	<style>
        .graph .axis {
            stroke-width: 1;
        }

        .graph .axis .tick line {
            stroke: black;
        }

        .graph .axis .tick text {
            fill: black;
            font-size: 0.7em;
        }

        .graph .axis .domain {
            fill: none;
            stroke: black;
        }

        .graph .group {
            fill: none;
            stroke: black;
            stroke-width: 1.5;
        }
	</style>
	<script src="//d3js.org/d3.v3.min.js"></script>
</head>

<body>
	<div class="graph"></div>
	<div class="button" id="addData">lisää</div>
	<div id="tableDiv">
		<table id="dataTable">
			<thead>
				<tr>
					<th class="dataCell">Accel X</th>
					<th class="dataCell">Accel Y</th>
					<th class="dataCell">Accel Z</th>
					<th class="dataCell">Rotation X</th>
					<th class="dataCell">Rotation Y</th>
					<th class="dataCell">Rotation Z</th>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
	<script>
		$(function() {

			$("#addData").click(function(){
				// push a new data point onto the back
				data.push({
					AccelX: 2,
					AccelY: 1.5,
					AccelZ: 1,
					RotationX: -1,
					RotationY: -1.5,
					RotationZ: -2,
					date: Date(Date.now())
				});

				// redraw the line, and then slide it to the left
				// path
				// 	.attr("d", line)
				// 	.attr("transform", null)
				// .transition()
				// 	.attr("transform", "translate(" + x(-1) + ")");

				// pop the old data point off the front
				data.shift();
			})
		});

			var groupNames = ['AccelX' ,'AccelY','AccelZ','RotationX','RotationY','RotationZ'];

			var c10 = d3.scale.category10();

			var limit = 60 * 1,
				duration = 750,
				now = new Date(Date.now() - duration)

			var width = 500,
				height = 200;

			var groups = {};
			for(i = 0; i<groupNames.length ; i++) {
				groups[groupNames[i]] = { 
					value : 0,
					color : c10(i),
					data: d3.range(limit).map(function() {
						return 0
					})
				};
			}

			var x = d3.time.scale()
				.domain([now - (limit - 2), now - duration])
				.range([0, width])

			var y = d3.scale.linear()
				.domain([-20000, 20000])
				.range([height, 0])

			var line = d3.svg.line()
				.interpolate('basis')
				.x(function(d, i) {
					return x(now - (limit - 1 - i) * duration)
				})
				.y(function(d) {
					return y(d)
				})

			var svg = d3.select('.graph').append('svg')
				.attr('class', 'chart')
				.attr('width', width)
				.attr('height', height + 50)

			var axis = svg.append('g')
				.attr('class', 'x axis')
				.attr('transform', 'translate(0,' + height + ')')
				.call(x.axis = d3.svg.axis().scale(x).orient('bottom'))

			var paths = svg.append('g')

			for (var name in groups) {
				var group = groups[name]
				group.path = paths.append('path')
					.data([group.data])
					.attr('class', name + ' group')
					.style('stroke', group.color)
			}

			function tick(data) {
				now = new Date();
				if(data.length == groupNames.length) {
					// Add new values
					for(i=0;i<groupNames.length;i++){
					// for (var name in groups) {
						var name = groupNames[i];
						var group = groups[name];
						//group.data.push(group.value) // Real values arrive at irregular intervals
						// group.data.push(20 + Math.random() * 100)
						group.data.push(data[i]);
						group.path.attr('d', line);
					}

					// Shift domain
					x.domain([now - (limit - 2) * duration, now - duration])

					// Slide x-axis left
					axis.transition()
						.duration(duration)
						.ease('linear')
						.call(x.axis)

					// Slide paths left
					paths.attr('transform', null)
						.transition()
						.duration(duration)
						.ease('linear')
						.attr('transform', 'translate(' + x(now - (limit - 1) * duration) + ')')
						.each('end', tick)

					// Remove oldest data point from each group
					for (var name in groups) {
						var group = groups[name]
						group.data.shift()
					}
				}
			}

        	//tick();
	</script>

</body>

</html>