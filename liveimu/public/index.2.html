<html>

<head>
    <title>Live IMU - 3D Example</title>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="main.1.js"></script>
    <link rel="stylesheet" type="text/css" href="main.css" />
    <style>
        .graph .axis {
            stroke-width: 1;
        }

            .graph .axis .tick line {
                stroke: black;
            }

            .graph .axis .tick text {
                fill: black;
                font-size: 0.7em;
            }

            .graph .axis .domain {
                fill: none;
                stroke: black;
            }

        .graph .group {
            fill: none;
            stroke: black;
            stroke-width: 1.5;
        }
    </style>
    <script src="//d3js.org/d3.v3.min.js"></script>
</head>

<body>
    <div class="graph"></div>
    <div class="button" id="pause">Pause</div>
    <div id="tableDiv">
        <table id="dataTable">
            <thead>
                <tr>
                    <th class="dataCell">Accel X</th>
                    <th class="dataCell">Accel Y</th>
                    <th class="dataCell">Accel Z</th>
                    <th class="dataCell">Rotation X</th>
                    <th class="dataCell">Rotation Y</th>
                    <th class="dataCell">Rotation Z</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <script>
        var groupNames = ['Timestamp', 'AccelX', 'AccelY', 'AccelZ', 'RotationX', 'RotationY', 'RotationZ'];
        var TIMESTAMP = 'Timestamp';

        var c10 = d3.scale.category10();

        var samples = 500;
        var timeStamps = Array(samples);
        var time = new Date();
        timeStamps.fill(time.getTime());

        var pause = false;

        var width = 500,
            height = 200;

        var groups = {};
        for (i = 0; i < groupNames.length ; i++) {
            groups[groupNames[i]] = {
                value: 0,
                color: c10(i),
                data: Array(samples).fill([time, 0])
            };
        }

        $(function () {

            $("#pause").click(function () {
                pause = !pause;
                if (pause) {
                    $("#pause").text("resume")
                } else {
                    $("#pause").text("pause")
                }
            })
            // kirjoitetaan sarakeotsikot
            $("#dataTable thead tr").html(groupNames.map(function (d) { return "<th>" + d + "</th>"; }).join(""))
        });



        var x = d3.time.scale()
            .domain([timeStamps[0], timeStamps[timeStamps.length - 1]])
            .range([0, width]);

        var y = d3.scale.linear()
            .domain([-20000, 20000])
            .range([height, 0])

        var line = d3.svg.line()
            .interpolate('basis')
            .x(function (d, i) {
                return x(d[0])
            })
            .y(function (d) {
                return y(d[1]);
            })

        var svg = d3.select('.graph').append('svg')
            .attr('class', 'chart')
            .attr('width', width)
            .attr('height', height + 50)

        var axis = svg.append('g')
            .attr('class', 'x axis')
            .attr('transform', 'translate(0,' + height + ')')
            .call(x.axis = d3.svg.axis().scale(x).orient('bottom'))

        var paths = svg.append('g')

        for (var name in groups) {
            var group = groups[name]
            group.path = paths.append('path')
                .data([group.data])
                .attr('class', name + ' group')
                .style('stroke', group.color)
        }
        /** @description Updates the screen with new data
         * @param {data} Array of integer values
         * @return {null} Nothing
         */
        function tick(data) {
            if (!pause) {
                if (data && data.length == groupNames.length) {
                    // p‰ivitet‰‰n taulukko

                    var rowCount = $('#dataTable > tbody > tr').length;
                    if ((rowCount + 1) >= rowsToKeep) {
                        // After adding rows, there will be too many, remove last
                        $('#dataTable > tbody > tr:last').remove();
                    }
                    // Prepare a row
                    var html = '<tr>';
                    for (var ii = 0; ii < data.length; ii++) {
                        html += '<td>' + data[ii] + '</td>';
                    }
                    html += '</tr>';

                    // Insert at the beginning
                    $(html).prependTo("#dataTable > tbody");

                    // p‰ivitet‰‰n kuvaaja
                    now = new Date();
                    // update Timestamps
                    var time = parseInt(data[0]);
                    timeStamps.push(time);
                    timeStamps.shift();

                    // Add new values
                    for (i = 1; i < groupNames.length; i++) {
                        var name = groupNames[i];
                        var group = groups[name];
                        group.data.push([time, parseInt(data[i])]);
                        group.path.attr('d', line);
                    }

                    // Shift domain
                    x.domain([timeStamps[0], time]);

                    //// Slide x-axis left
                    //axis.transition()
                    //    .duration(duration)
                    //    .ease('linear')
                    //    .call(x.axis)
                    axis.call(x.axis);
                    // Slide paths left
                    //paths.attr('transform', null)
                    //    .transition()
                    //    .duration(duration)
                    //    .ease('linear')
                    //    .attr('transform', 'translate(' + x(now - (limit - 1) * duration) + ')')
                    //    .each('end', tick)

                    // Remove oldest data point from each group
                    for (var name in groups) {
                        var group = groups[name]
                        group.data.shift()
                    }
                }
            }
        }
    </script>

</body>

</html>